metadata:
  title: Students overview smoke (MCP)
  description: |
    Exercise the login flow and verify the students list renders with the add student form
    using the Model Context Protocol client controls.
  tags:
    - smoke
    - students
config:
  browser: chromium
  headless: true
  baseUrl: "{{environment.baseUrl}}"
steps:
  - navigate: "{{config.baseUrl}}/login"
  - fill:
      selector: 'input[formcontrolname="username"]'
      value: '{{secrets.username}}'
  - fill:
      selector: 'input[formcontrolname="password"]'
      value: '{{secrets.password}}'
  - click:
      selector: 'button[type="submit"]'
  - waitFor:
      selector: 'h1'
      text: 'Texas TEKS Program Manager'
  - navigate: "{{config.baseUrl}}/students"
  - waitFor:
      selector: 'h2'
      text: 'Students'
  # Mirror E2E: Add Student should be disabled until the form is filled
  - evaluate:
      script: |
        () => {
          const buttons = Array.from(document.querySelectorAll('button'));
          const target = buttons.find(b => (b.textContent || '').trim().toLowerCase() === 'add student');
          if (!target) throw new Error('Add Student button not found');
          const disabled = target.hasAttribute('disabled') || (/** @type {HTMLButtonElement} */(target)).disabled === true;
          if (!disabled) throw new Error('Add Student button is expected to be disabled');
          return true;
        }
  - screenshot:
      name: 'students-overview'
      fullPage: true
